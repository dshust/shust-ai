<% content_for :title, "#{@service.name} — Энва" %>

<div class="flex h-[calc(100vh-56px)]">

  <%# Левая боковая панель с инфо %>
  <div class="w-[280px] shrink-0 bg-white border-r border-[#e5e5e5] flex flex-col">
    <div class="p-5 border-b border-[#e5e5e5]">
      <div class="w-12 h-12 rounded-xl bg-[#f0f0ff] flex items-center justify-center text-2xl mb-3">
        <%= @service.emoji || "⚡" %>
      </div>
      <h2 class="text-[15px] font-semibold text-[#1a1a1a] leading-snug"><%= @service.name %></h2>
      <div class="mt-2">
        <% if @service.published? %>
          <span style="display:inline-flex;align-items:center;font-size:12px;font-weight:500;padding:2px 8px;border-radius:6px;background:#f0faf4;color:#008744;">Опубликован</span>
        <% else %>
          <span style="display:inline-flex;align-items:center;font-size:12px;font-weight:500;padding:2px 8px;border-radius:6px;background:#f5f5f5;color:#737373;">Черновик</span>
        <% end %>
      </div>
    </div>

    <div class="p-5 flex flex-col gap-3 flex-1">
      <div>
        <p class="text-xs font-medium text-[#a0a0a0] uppercase tracking-wider mb-1.5">Запрос</p>
        <p class="text-sm text-[#404040] leading-relaxed"><%= @service.prompt %></p>
      </div>

      <div class="text-xs text-[#c0c0c0] mt-auto">
        Создан <%= @service.created_at.strftime("%d.%m.%Y") %>
      </div>
    </div>

    <div class="p-5 border-t border-[#e5e5e5] flex flex-col gap-2">
      <% unless @service.published? %>
        <%= button_to "Опубликовать", publish_enva_service_path(@service),
          method: :post,
          style: "display:flex;align-items:center;justify-content:center;gap:6px;width:100%;background:#0000CC;color:white;font-size:14px;font-weight:500;padding:10px 16px;border-radius:8px;border:none;cursor:pointer;" %>
      <% end %>

      <a href="<%= new_enva_service_path %>"
        style="display:flex;align-items:center;justify-content:center;gap:6px;width:100%;background:white;color:#1a1a1a;font-size:14px;font-weight:500;padding:9px 16px;border-radius:8px;border:1px solid #e5e5e5;text-decoration:none;text-align:center;">
        Создать новый
      </a>
    </div>
  </div>

  <%# Правая панель — iframe с генерированным HTML %>
  <div class="flex-1 flex flex-col bg-[#f0f0f0]">
    <div class="bg-white border-b border-[#e5e5e5] px-4 h-10 flex items-center gap-2 text-xs text-[#a0a0a0]">
      <div class="flex gap-1.5">
        <div class="w-3 h-3 rounded-full bg-[#ff5f57]"></div>
        <div class="w-3 h-3 rounded-full bg-[#ffbd2e]"></div>
        <div class="w-3 h-3 rounded-full bg-[#28c840]"></div>
      </div>
      <span class="ml-2 bg-[#f5f5f5] rounded px-3 py-0.5 text-[#737373]">enva://сервис/<%= @service.id %></span>
    </div>
    <iframe
      id="service-frame"
      class="flex-1 w-full border-0"
      sandbox="allow-scripts allow-forms allow-same-origin"
    ></iframe>
  </div>

</div>

<script>
  const html = <%= raw @service.generated_html.to_json %>;
  const frame = document.getElementById('service-frame');
  const blob = new Blob([html], { type: 'text/html' });
  frame.src = URL.createObjectURL(blob);
</script>
